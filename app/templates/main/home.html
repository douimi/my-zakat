{% extends 'base.html' %}
{% block content %}
{% from "components/_carousel.html" import render_carousel %}
{% set current_time = now %}




<!-- üîπ Enhanced Hero Section -->
<section class="hero-section fade-in">
    <video class="hero-video" autoplay  loop playsinline poster="{{ url_for('static', filename='images/hero.jpg') }}" muted>
        <source src="{{ url_for('static', filename='videos/zakat_impact.mp4') }}" type="video/mp4">
        <img src="{{ url_for('static', filename='images/hero.jpg') }}" alt="Zakat Charity Support" class="hero-image">
    </video>
    <div class="hero-overlay"></div>
    <div class="hero-content">
        <h1>Your Zakat, Their Lifeline</h1>
        <p>Join us in making a difference in the lives of those in need.</p>
        <a href="{{ url_for('main.donate') }}" class="button">Donate Now</a>
        <p class="trust-message">üåç Trusted by 10,000+ donors worldwide</p>
    </div>
</section>

<!-- Scroll Down Arrow - overlays the hero -->
<div class="scroll-down-indicator fixed-outside">
    <a href="#impact"><i class="fas fa-chevron-down"></i></a>
</div>

<div class="welcome-message fade-in">
    <h2><i class="fas fa-hands-holding-heart" style="color:#28a745;margin-right:10px;"></i>Welcome to the Zakat Distribution Foundation</h2>
    <div class="sub-nav-inline">
        <a href="#impact"><i class="fas fa-chart-line"></i> Impact</a>
        <a href="#programs"><i class="fas fa-hand-holding-heart"></i> Programs</a>
        <a href="#volunteer"><i class="fas fa-users"></i> Volunteer</a>
        <a href="#sadaqa"><i class="fas fa-donate"></i> Monthly Giving</a>
        <a href="#events"><i class="fas fa-calendar-alt"></i> Events</a>
        <a href="#difference"><i class="fas fa-globe-americas"></i> Make A Difference</a>
    </div>
    
</div>



<!-- üîπ Separator -->
<div class="gradient-section slim"></div>


<!-- üîπ Image Carousel Section with Text -->
<h2 class="section-title"><span class="section-icon"><i class="fas fa-images"></i></span>Our Mission in Action</h2>
{{ render_carousel([
  {"image": url_for('static', filename='images/slides_mia/slide1.jpg'), "alt": "Helping the needy", "text": "A small act of kindness..."},
  {"image": url_for('static', filename='images/slides_mia/slide2.jpg'), "alt": "Feeding families", "text": "Your Zakat feeds the hungry..."},
  {"image": url_for('static', filename='images/slides_mia/slide3.jpg'), "alt": "Supporting orphans", "text": "Every donation brings hope..."},
  {"image": url_for('static', filename='images/slides_mia/slide4.jpg'), "alt": "Empowering communities", "text": "Together, we empower communities..."},
  {"image": url_for('static', filename='images/slides_mia/slide5.jpg'), "alt": "Building a better future", "text": "Your support builds a brighter future..."},
], id="main-carousel", style="dark") }}



<!-- üîπ Separator -->
<div class="gradient-section slim"></div>

<!-- üîπ How It Works Section -->
<section class="how-it-works-section fade-in">
  <h2 class="section-title"><span class="section-icon"><i class="fas fa-cogs"></i></span>How It Works</h2>
  <div class="how-it-works-steps">
    <div class="how-step">
      <div class="how-icon"><i class="fas fa-hand-holding-usd"></i></div>
      <h3>1. You Donate</h3>
      <p>Choose your cause and make a secure Zakat or Sadaqa donation online.</p>
    </div>
    <div class="how-step">
      <div class="how-icon"><i class="fas fa-people-carry"></i></div>
      <h3>2. We Deliver</h3>
      <p>Our team ensures your donation reaches those most in need, quickly and transparently.</p>
    </div>
    <div class="how-step">
      <div class="how-icon"><i class="fas fa-smile-beam"></i></div>
      <h3>3. Lives Change</h3>
      <p>Your generosity provides food, water, education, and hope to families and children.</p>
    </div>
  </div>
</section>

<!-- üîπ Separator -->
<div class="gradient-section slim"></div>


<!-- Impact Section (Original, reverted) -->
<section class="impact-section fade-in">
    <h2 class="section-title"><span class="section-icon"><i class="fas fa-hands-helping"></i></span>The Impact of Your Zakat</h2>
    <div class="impact-container">
        <div class="impact-video">
          <video controls poster="{{ url_for('static', filename='images/slide1.jpg') }}" class="impact-video-element">
            <source src="{{ url_for('static', filename='videos/zakat_impact.mp4') }}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
          <img src="{{ url_for('static', filename='images/slide1.jpg') }}" alt="Impact Poster" class="impact-video-poster" style="display:none;">
        </div>
        <div class="impact-text">
            <h3 class="impact-heading">
                <i class="fas fa-hands-helping"></i> Every Zakat Makes a Difference
            </h3>
            <p>
                Your generosity brings hope and relief to children who have been victims of war and displacement.
                Watch this short video to see how your donations make a life-changing difference.
            </p>
        </div>
    </div>
    <div class="impact-donate-wrapper">
        <a href="{{ url_for('main.donate') }}" class="impact-donate-button cta-button">Donate Now</a>
    </div>
</section>
  
<!-- üîπ Separator -->
<div class="gradient-section slim"></div>



<!-- üîπ Ramadan Giving Campaign Section -->
<section class="ramadan-campaign modern-ramadan-section">
    <div class="ramadan-bg"></div>
    <div class="campaign-content">
        <img src="{{ url_for('static', filename='images/ramadan_drive.jpg') }}" alt="Ramadan Food Drive" class="campaign-image">
        <div class="campaign-text">
            <h2 class="section-title"><span class="section-icon"><i class="fas fa-moon"></i></span>Ramadan Giving Campaign</h2>
            <p>Join us in making a difference this Ramadan. Your Zakat and Sadaqa help provide food, water, and essential supplies to those in need.</p>

            <!-- Progress Tracker -->
            <div class="progress-bar modern-progress">
                <div class="progress-label">Raised: ${{ total_ramadan_donations + 2000|int }} of $50,000 goal</div>
                <div class="progress-fill" style="width: {{ (total_ramadan_donations / 50000) * 100 }}%; transition: width 1.2s cubic-bezier(.4,2,.6,1);"></div>
            </div>
            <!-- Call to Action -->
            <a href="{{ url_for('main.donate') }}" class="campaign-button modern-cta">Donate Now</a>
        </div>
    </div>
</section>

<!-- üîπ Separator -->
<div class="gradient-section slim"></div>


<!-- üîπ Testimonials & Impact Stories Section as Cards -->
<h2 class="section-title"><span class="section-icon"><i class="fas fa-star"></i></span>What People Say About Us</h2>
<p class="section-subtitle">Short quotes from those you‚Äôve helped</p>
<div class="testimonials-cards-container">
  {% for t in testimonials %}
    <div class="testimonial-card fade-in">
      <div class="testimonial-img-oval testimonial-video-thumb" {% if t.video_url %}data-video="{{ url_for('static', filename=t.video_url) }}" tabindex="0" role="button" aria-label="Play testimonial video for {{ t.name }}"{% endif %}>
        <img src="{{ url_for('static', filename=t.image) if t.image else url_for('static', filename='images/default_user.png') }}" alt="{{ t.name }}">
        {% if t.video_url %}
          <span class="video-play-overlay"><i class="fas fa-play-circle"></i></span>
        {% endif %}
      </div>
      <div class="testimonial-text">{{ t.text }}</div>
      <div class="testimonial-name">{{ t.name }}</div>
    </div>
  {% endfor %}
</div>
<div class="testimonial-share-container" style="text-align:center;margin-top:24px;">
  <a href="{{ url_for('main.submit_testimonial') }}" class="button share-story-btn">
    <i class="fas fa-pen-nib"></i> Share Your Story
  </a>
</div>

<!-- Testimonial Video Modal -->
<div id="testimonialVideoModal" class="video-modal" tabindex="-1" aria-modal="true" role="dialog" style="display:none;">
  <div class="video-modal-content">
    <span class="video-modal-close" tabindex="0" aria-label="Close video">&times;</span>
    <video id="testimonialVideoPlayer" controls style="max-width:100%;max-height:70vh;outline:none;">
      <source src="" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </div>
</div>

<!-- Story Video Modal (reuse testimonial modal for simplicity) -->
<!-- No duplicate modal needed, just use the same one for both -->

<div class="gradient-section slim"></div>

{% if story_slides %}

<section id="featured" class="real-stories fade-in">
  <h2 class="section-title"><span class="section-icon"><i class="fas fa-book-open"></i></span>Real Stories, Real People</h2>
  {{ render_carousel(story_slides, id="featured-carousel") }}

  <div class="view-more-stories">
    <a href="{{ url_for('main.stories') }}" class="story-button">
      <i class="fas fa-book-open"></i> View All Stories
    </a>
  </div>
  <br>
</section>
{% endif %}



<!-- üîπ Separator -->
<div class="gradient-section slim"></div>


<!-- üîπ Monthly Donors (Sadaqa Jariya) Section -->
<section id="sadaqa" class="sadaqa-jariya fade-in">
    <h2 class="section-title"><span class="section-icon"><i class="fas fa-donate"></i></span>Be a Lifeline ‚Äî Join Our Monthly Donors</h2>
    <p>Your steady support means food, shelter, and hope ‚Äî every single month.</p>
    <p class="monthly-count">üåü 152 families rely on monthly donors like you.</p>

    <div class="donor-grid">
        <div class="donor-card fade-in">
            <img src="{{ url_for('static', filename='images/donors/donor1.jpg') }}" alt="Donor 1">
            <p><strong>Ali Khan</strong></p>
            <p>"Giving monthly brings joy to my heart, knowing I'm helping someone in need."</p>
            <div class="donor-impact-badge">üå± Sustains 3 families</div>
        </div>
        <div class="donor-card fade-in">
            <img src="{{ url_for('static', filename='images/donors/donor2.jpg') }}" alt="Donor 2">
            <p><strong>Fatima Ahmed</strong></p>
            <p>"Sadaqa Jariya is my way of leaving a lasting impact."</p>
            <div class="donor-impact-badge">üìö Supports 2 orphans</div>
        </div>
        <div class="donor-card fade-in">
            <img src="{{ url_for('static', filename='images/donors/donor3.jpg') }}" alt="Donor 3">
            <p><strong>Ameerah Yusuf</strong></p>
            <p>"Giving monthly allows me to support causes close to my heart effortlessly."</p>
            <div class="donor-impact-badge">üç≤ Provides 30 meals/month</div>
        </div>
    </div>

    <div class="donate-monthly">
        <a href="{{ url_for('main.donate') }}" class="cta-button big-donate-button">
            üíö Start Giving Monthly
        </a>
    </div>
</section>

<!-- üîπ Separator -->
<div class="gradient-section slim"></div>

<!-- üîπ Our Programs Section -->
<div class="section-visual-sep section-gradient-blue">
  <section id="programs" class="programs-section fade-in">
      <h2 class="section-title"><span class="section-icon"><i class="fas fa-hands-helping"></i></span>Our Programs</h2>
      <p class="section-tagline">Empowering communities through focused initiatives</p>
      <div class="programs-container">
          <div class="program-box">
              <img src="{{ url_for('static', filename='images/programs/program1.jpg') }}" alt="Food & Water Aid">
              <h3><span class="program-icon"><i class="fas fa-utensils"></i></span> Food & Water Aid</h3>
              <p>Delivering essential food parcels and clean water to families in crisis zones.</p>
              <a href="{{ url_for('main.program_detail', program_slug='food-water-aid') }}" class="program-learn-more">Learn More</a>
          </div>
          <div class="program-box">
              <img src="{{ url_for('static', filename='images/programs/program2.jpg') }}" alt="Emergency Relief">
              <h3><span class="program-icon"><i class="fas fa-ambulance"></i></span> Emergency Relief</h3>
              <p>Rapid response for victims of war, disaster, and displacement with shelter and supplies.</p>
              <a href="{{ url_for('main.program_detail', program_slug='emergency-relief') }}" class="program-learn-more">Learn More</a>
          </div>
          <div class="program-box">
              <img src="{{ url_for('static', filename='images/programs/program3.jpg') }}" alt="Orphan & Child Care">
              <h3><span class="program-icon"><i class="fas fa-child"></i></span> Orphan & Child Care</h3>
              <p>Providing education, safety, and hope for orphaned and vulnerable children.</p>
              <a href="{{ url_for('main.program_detail', program_slug='orphan-child-care') }}" class="program-learn-more">Learn More</a>
          </div>
      </div>
  </section>
</div>

<!-- üîπ Making a Difference Section -->
<div class="section-visual-sep section-gradient-light">
  <section  class="make-difference-section fade-in">
      <h2 class="section-title"><span class="section-icon"><i class="fas fa-globe-americas"></i></span>Making a Difference</h2>
      <p class="section-tagline">Real Stories, Real Change, Real Impact...</p>
      <div class="make-difference-container">
          <div class="make-difference-images">
              <img src="{{ url_for('static', filename='images/difference/impact1.jpeg') }}" alt="Community Water Project">
          </div>
          <div class="make-difference-content">
              <blockquote class="impact-quote">
                  <i class="fas fa-quote-left"></i>
                  "Through our water well initiatives, we have provided clean drinking water to thousands of families in remote areas."
                  <i class="fas fa-quote-right"></i>
              </blockquote>
              <p class="impact-story-text">
                  Our donors made it possible for Fatima's village to have safe water for the first time. <strong>Every donation brings hope and health to entire communities.</strong>
              </p>
              <a href="{{ url_for('main.stories') }}" class="impact-cta-button">Read More Stories</a>
          </div>
      </div>
  </section>
</div>



<!-- üîπ Sponsor a Child / Family Section -->
<div class="section-visual-sep section-gradient-gold">
  <section id="difference" class="sponsorship-section fade-in">
      <h2 class="section-title"><span class="section-icon"><i class="fas fa-child"></i></span>Make a Difference: Sponsor a Child, Orphan, or Family</h2>
      <p class="section-tagline">Your sponsorship provides food, shelter, education, and healthcare for those in need.</p>
      <div class="sponsorship-container">
          <!-- Sponsor a Child -->
          <div class="sponsorship-box">
              <img src="{{ url_for('static', filename='images/difference/sponsor_child.jpg') }}" alt="Sponsor a Child">
              <h3>Sponsor a Child</h3>
              <p>Help provide a brighter future for a child in need by covering their basic necessities and education.</p>
              <a href="{{ url_for('main.donate') }}" class="sponsor-button">Sponsor Now</a>
          </div>
          <!-- Sponsor an Orphan -->
          <div class="sponsorship-box">
              <img src="{{ url_for('static', filename='images/difference/sponsor_orphan.jpg') }}" alt="Sponsor an Orphan">
              <h3>Sponsor an Orphan</h3>
              <p>Support an orphan by giving them access to food, shelter, and education to build a better life.</p>
              <a href="{{ url_for('main.donate') }}" class="sponsor-button">Sponsor Now</a>
          </div>
          <!-- Sponsor a Family -->
          <div class="sponsorship-box">
              <img src="{{ url_for('static', filename='images/difference/sponsor_family.jpg') }}" alt="Sponsor a Family">
              <h3>Sponsor a Family</h3>
              <p>Provide urgent support to families struggling with poverty and displacement through your generous donations.</p>
              <a href="{{ url_for('main.donate') }}" class="sponsor-button">Sponsor Now</a>
          </div>
      </div>
  </section>
</div>

<!-- üîπ Separator -->
<div class="gradient-section slim"></div>


<!-- üîπ Volunteer Section -->
<section id="volunteer" class="volunteer-section" fade-in>
    <h2 class="section-title"><span class="section-icon"><i class="fas fa-users"></i></span>Get Involved: Volunteer With Us</h2>
    <p>Make a difference by joining our team of volunteers. Here are some ways you can help:</p>

    <div class="volunteer-container">
        <div class="volunteer-box">
            <img src="{{ url_for('static', filename='images/volunteer.jpg') }}" alt="Volunteer Opportunity">
            <h3>General Volunteering</h3>
            <p>Help distribute aid, organize events, and make a difference in your community.</p>
            <a href="{{ url_for('main.volunteer') }}" class="volunteer-button">Volunteer</a>
        </div>

        <div class="volunteer-box">
            <img src="{{ url_for('static', filename='images/fundraiser.jpg') }}" alt="Fundraising">
            <h3>Fundraising</h3>
            <p>Raise funds to support our mission and provide resources for those in need.</p>
            <a href="{{ url_for('main.volunteer') }}" class="volunteer-button">Get Involved</a>
        </div>

        <div class="volunteer-box">
            <img src="{{ url_for('static', filename='images/outreach_coordinator.jpg') }}" alt="Community Outreach">
            <h3>Community Outreach</h3>
            <p>Engage with local communities to spread awareness and expand our reach.</p>
            <a href="{{ url_for('main.volunteer') }}" class="volunteer-button">Join Now</a>
        </div>
    </div>
</section>



<!-- üîπ Separator -->
<div class="gradient-section slim"></div>


<!-- üîπ Why Give Zakat CTA Section -->
<h2 class="section-title"><span class="section-icon"><i class="fas fa-balance-scale"></i></span>Why Give Zakat?</h2>
<section class="cta-section fade-in">
  <p>Zakat is not just charity ‚Äî it's a duty and a powerful tool to uplift lives. Here's why your Zakat matters:</p>

  <ul class="zakat-reasons">
    <li>üïå It's one of the Five Pillars of Islam ‚Äî a divine obligation.</li>
    <li>ü§ù It purifies your wealth and supports the most vulnerable in our global community.</li>
    <li>üåç Your Zakat provides food, shelter, education, and hope where it's needed most.</li>
  </ul>

  <div class="cta-buttons">
    <a href="{{ url_for('main.zakat_education') }}" class="cta-button">Learn About Zakat</a>
    <a href="{{ url_for('main.donate') }}" class="cta-button">Give Now</a>
  </div>
</section>



<!-- üîπ Separator -->
<div class="gradient-section slim"></div>


<section id="events" class="events-section fade-in">
    <h2 class="section-title"><span class="section-icon"><i class="fas fa-calendar-alt"></i></span>Upcoming Events</h2>
    <p>Join our upcoming charity events and make a difference in people's lives.</p>

    <div class="events-container">
        {% for event in events %}
        <div class="event-box">
            <img src="{{ url_for('static', filename='images/events/' ~ event.image) }}" alt="{{ event.title }}">
            <h3>{{ event.title }}</h3>
            <p>{{ event.description[:100] }}...</p>
            <p><strong>Date:</strong> {{ event.date.strftime('%B %d, %Y') }}</p>
            <a href="{{ url_for('events.event_details', event_id=event.id) }}" class="event-button">Learn More</a>
        </div>
        {% endfor %}
    </div>
</section>


<!-- üîπ Separator -->
<div class="gradient-section slim"></div>

<!-- üîπ Social Media & Latest News Section -->
<section class="news-social-section fade-in">
    <div class="news-container">
        <h3>Latest News</h3>
        {% for press in press_list[:2] %}
        <div class="news-item">
            <img src="{{ url_for('static', filename=press.image) if press.image else url_for('static', filename='images/news1.jpeg') }}" alt="News Image">
            <div class="news-content">
                <h4>{{ press.title }}</h4>
                <p>{{ press.summary or press.content[:100] ~ '...' }}</p>
                <a href="{{ url_for('main.press_detail', press_id=press.id) }}">Read More</a>
            </div>
        </div>
        {% endfor %}
        <div class="view-all-news" style="text-align:center;margin-top:18px;">
            <a href="{{ url_for('main.press') }}" class="button news-view-all-btn">
                <i class="fas fa-newspaper"></i> View All News
            </a>
        </div>
    </div>

    <div class="social-container">
        <h3>Follow Us</h3>
        <div class="social-icons">
            <a href="https://twitter.com/YOURHANDLE" target="_blank" aria-label="Twitter" class="social-icon twitter"><i class="fab fa-twitter"></i></a>
            <a href="https://facebook.com/YOURPAGE" target="_blank" aria-label="Facebook" class="social-icon facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="https://instagram.com/YOURHANDLE" target="_blank" aria-label="Instagram" class="social-icon instagram"><i class="fab fa-instagram"></i></a>
            <a href="https://linkedin.com/YOURPAGE" target="_blank" aria-label="LinkedIn" class="social-icon linkedin"><i class="fab fa-linkedin-in"></i></a>
            <a href="https://youtube.com/YOURCHANNEL" target="_blank" aria-label="YouTube" class="social-icon youtube"><i class="fab fa-youtube"></i></a>
        </div>
        <div class="social-tagline">Stay connected for updates and inspiration! Also follow us on your favorite social media outlet</div>
    </div>

</section>

<div class="section-Separator"></div>

<!-- üîπ Newsletter Subscription Section -->
<section class="newsletter-section fade-in">
    <div class="newsletter-content newsletter-card">
        <h2 class="section-title"><span class="section-icon"><i class="fas fa-envelope"></i></span>Stay Updated with Our Latest News</h2>
        <p>Subscribe to our newsletter to receive updates on our latest campaigns, success stories, and upcoming events.</p>
        {% if newsletter_message %}
            <div class="newsletter-feedback {{ 'success' if newsletter_success else 'error' }}">
                {{ newsletter_message }}
            </div>
        {% endif %}
        <form action="{{ url_for('main.subscribe') }}" method="POST" class="newsletter-form">
            <input type="email" name="email" placeholder="Enter your email address" required>
            <button type="submit" class="subscribe-button">Subscribe</button>
        </form>
    </div>
</section>

<!-- üîπ Separator -->
<div class="gradient-section slim"></div>

<section id="impact" class="impact-summary section-light fade-in">
  <h2 class="section-title"><span class="section-icon"><i class="fas fa-chart-line"></i></span>Our Impact So Far</h2>

  <!-- Progress Bar -->
  <div class="progress-bar-container">
    <span class="progress-label">Funds Raised: ${{ total_donations }} / $500,000 Goal</span>
    <div class="progress-bar">
      <div class="progress-fill" style="width: {{ (total_donations / 500000) * 100 }}%;"></div>
    </div>
  </div>

  <div class="stats-container impact-stats-cards">
    <div class="stat-card">
      <i class="fas fa-utensils stat-icon"></i>
      <h3 class="counter" data-target="{{ meals }}">0</h3>
      <p>Meals Provided</p>
    </div>
    <div class="stat-card">
      <i class="fas fa-home stat-icon"></i>
      <h3 class="counter" data-target="{{ families }}">0</h3>
      <p>Families Helped</p>
    </div>
    <div class="stat-card">
      <i class="fas fa-child stat-icon"></i>
      <h3 class="counter" data-target="{{ orphans }}">0</h3>
      <p>Orphans Sponsored</p>
    </div>
    <div class="stat-card">
      <i class="fas fa-hand-holding-usd stat-icon"></i>
      <h3 class="counter" data-target="{{ total_donations|int }}">$0</h3>
      <p>Total Donations</p>
    </div>
  </div>
</section>

<!-- üîπ Sticky CTA Banner -->
<div class="sticky-cta-banner" role="region" aria-label="Call to Action">
    <span class="cta-banner-text"><i class="fas fa-donate"></i> Make an Impact ‚Äî Your Zakat Changes Lives!</span>
    <a href="{{ url_for('main.donate') }}" class="cta-banner-button">Donate Now</a>
</div>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const counters = document.querySelectorAll(".counter");

  const animateCounter = (el) => {
    const target = +el.getAttribute("data-target");
    const increment = target / 80;
    let count = 0;

    const update = () => {
      count += increment;
      if (count < target) {
        el.innerText = el.innerText.includes('$')
          ? '$' + Math.ceil(count).toLocaleString()
          : Math.ceil(count).toLocaleString();
        requestAnimationFrame(update);
      } else {
        el.innerText = el.innerText.includes('$')
          ? '$' + target.toLocaleString()
          : target.toLocaleString();
      }
    };
    update();
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting && entry.target.classList.contains("counter")) {
        animateCounter(entry.target);
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.5 });

  counters.forEach(counter => {
    observer.observe(counter);
  });
});
</script>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const carousels = document.querySelectorAll("[data-carousel]");

  carousels.forEach(carousel => {
    const slides = carousel.querySelectorAll("[data-slides] .carousel-slide");
    const dotsContainer = carousel.querySelector("[data-dots]");
    const prevBtn = carousel.querySelector("[data-prev]");
    const nextBtn = carousel.querySelector("[data-next]");
    let index = 0;

    const showSlide = (i) => {
      if (i >= slides.length) index = 0;
      if (i < 0) index = slides.length - 1;

      slides.forEach((slide, j) => {
        slide.classList.toggle("active", j === index);
      });

      if (dotsContainer) {
        dotsContainer.innerHTML = '';
        slides.forEach((_, j) => {
          const dot = document.createElement("span");
          dot.className = "dot" + (j === index ? " active" : "");
          dot.onclick = () => { index = j; showSlide(index); };
          dotsContainer.appendChild(dot);
        });
      }
    };

    // Buttons
    if (prevBtn) prevBtn.onclick = () => { index--; showSlide(index); };
    if (nextBtn) nextBtn.onclick = () => { index++; showSlide(index); };

    // Remove auto-advance interval to prevent page from moving without scrolling
    // let intervalId = setInterval(() => { index++; showSlide(index); }, 6000);
    // carousel.addEventListener("mouseenter", () => clearInterval(intervalId));
    // carousel.addEventListener("mouseleave", () => {
    //   intervalId = setInterval(() => { index++; showSlide(index); }, 6000);
    // });

    showSlide(index); // initialize first visible slide
  });
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function() {
  // Testimonial and Story video modal logic
  const modal = document.getElementById('testimonialVideoModal');
  const video = document.getElementById('testimonialVideoPlayer');
  const closeBtn = document.querySelector('.video-modal-close');

  // For testimonial videos
  document.querySelectorAll('.testimonial-video-thumb[data-video]').forEach(el => {
    el.addEventListener('click', function() {
      video.querySelector('source').src = this.getAttribute('data-video');
      video.load();
      modal.style.display = 'flex';
      video.focus();
    });
    el.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        this.click();
      }
    });
  });

  // For story videos in carousel
  document.querySelectorAll('.story-video-thumb[data-video]').forEach(el => {
    el.addEventListener('click', function() {
      const videoUrl = this.getAttribute('data-video');
      video.querySelector('source').src = videoUrl;
      video.src = videoUrl;
      video.load();
      modal.style.display = 'flex';
      setTimeout(() => { video.play(); }, 100);
      video.focus();
    });
    el.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        this.click();
      }
    });
  });

  closeBtn.addEventListener('click', function() {
    modal.style.display = 'none';
    video.pause();
    video.currentTime = 0;
    video.src = '';
    video.querySelector('source').src = '';
    video.load();
  });
  modal.addEventListener('click', function(e) {
    if (e.target === modal) {
      modal.style.display = 'none';
      video.pause();
      video.currentTime = 0;
      video.src = '';
      video.querySelector('source').src = '';
      video.load();
    }
  });
  document.addEventListener('keydown', function(e) {
    if (modal.style.display === 'flex' && (e.key === 'Escape' || e.key === 'Esc')) {
      modal.style.display = 'none';
      video.pause();
      video.currentTime = 0;
      video.src = '';
      video.querySelector('source').src = '';
      video.load();
    }
  });
});
</script>
{% endblock %}
